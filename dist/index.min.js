!function(e,s){"object"==typeof exports&&"undefined"!=typeof module?s(exports,require("mocha"),require("applause-reporter-common")):"function"==typeof define&&define.amd?define(["exports","mocha","applause-reporter-common"],s):s((e="undefined"!=typeof globalThis?globalThis:e||self)["mocha-applause-reporter"]={},e.mocha,e.applauseReporterCommon)}(this,(function(e,s,t){"use strict";const o="applause-session-id-register";function n(e){this.test instanceof s.Test?this.test?.emit(o,e):this.test instanceof s.Hook&&this.currentTest instanceof s.Test&&this.currentTest?.emit(o,e)}class i extends s.reporters.Base{reporter;sessionIdMap=new Map;constructor(e){super(e);const o=t.loadConfig();this.reporter=new t.ApplauseReporter(o),e.once(s.Runner.constants.EVENT_SUITE_BEGIN,(e=>{const s=[];e.eachTest((e=>s.push(e.fullTitle()))),this.reporter.runnerStart(s)})),e.on(s.Runner.constants.EVENT_TEST_BEGIN,(e=>{this.listenToSessionId(e),this.reporter.startTestCase(e.id,e.fullTitle())})).on(s.Runner.constants.EVENT_TEST_PASS,(e=>{this.reporter.submitTestCaseResult(e.id,t.TestResultStatus.PASSED,{providerSessionGuids:this.sessionIdMap.get(e.id)||[]})})).on(s.Runner.constants.EVENT_TEST_PENDING,(e=>{this.reporter.submitTestCaseResult(e.id,t.TestResultStatus.SKIPPED,{providerSessionGuids:this.sessionIdMap.get(e.id)||[]})})).on(s.Runner.constants.EVENT_TEST_FAIL,((e,s)=>{this.reporter.submitTestCaseResult(e.id,t.TestResultStatus.FAILED,{failureReason:s.message,providerSessionGuids:this.sessionIdMap.get(e.id)||[]})})).once(s.Runner.constants.EVENT_RUN_END,(()=>{this.reporter.runnerEnd()}))}recordSessionId(e,s){this.sessionIdMap.set(e,[...this.sessionIdMap.get(e)||[],s])}listenToSessionId(e){e.on(o,(s=>this.recordSessionId(e.id,s)))}}e.SESSION_ID_EVENT=o,e.default=i,e.registerSessionId=n,e.registerSessionIdHook=function(e){return function(){this.test instanceof s.Hook&&!this.test.title.startsWith('"before each"')?console.warn("Can only register session id in the beforeEach hook"):n.apply(this,[e()])}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.min.js.map
