{"version":3,"file":"hooks.mjs","sources":["../src/hooks.ts"],"sourcesContent":["import { Hook, Test } from 'mocha';\n\nexport const SESSION_ID_EVENT = 'applause-session-id-register';\n\nexport function registerSessionIdHook(\n  sessionIdLookup: () => string | undefined\n) {\n  return function (this: Mocha.Context) {\n    if (\n      this.test instanceof Hook &&\n      !this.test.title.startsWith('\"before each\"')\n    ) {\n      console.warn('Can only register session id in the beforeEach hook');\n      return;\n    }\n    registerSessionId.apply(this, [sessionIdLookup()]);\n  };\n}\n\nexport function registerSessionId(\n  this: Mocha.Context,\n  sessionId: string | undefined\n) {\n  // this: Mocha.Context can be executed for either a Hook for a test. If this is being executed for a Hook,\n  // we want to emit the event on the currentTest, not the test (which is actually the hook)\n  if (this.test instanceof Test) {\n    this.test?.emit(\n      SESSION_ID_EVENT,\n      JSON.stringify({ fullTitle: this.test?.fullTitle(), sessionId })\n    );\n  } else if (this.test instanceof Hook && this.currentTest instanceof Test) {\n    this.currentTest?.emit(\n      SESSION_ID_EVENT,\n      JSON.stringify({ fullTitle: this.currentTest?.fullTitle(), sessionId })\n    );\n  }\n}\n"],"names":[],"mappings":";;AAEO,MAAM,gBAAgB,GAAG,+BAA+B;AAEzD,SAAU,qBAAqB,CACnC,eAAyC,EAAA;IAEzC,OAAO,YAAA;AACL,QAAA,IACE,IAAI,CAAC,IAAI,YAAY,IAAI;YACzB,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,eAAe,CAAC,EAC5C;AACA,YAAA,OAAO,CAAC,IAAI,CAAC,qDAAqD,CAAC,CAAC;YACpE,OAAO;AACR,SAAA;QACD,iBAAiB,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,eAAe,EAAE,CAAC,CAAC,CAAC;AACrD,KAAC,CAAC;AACJ,CAAC;AAEK,SAAU,iBAAiB,CAE/B,SAA6B,EAAA;;;AAI7B,IAAA,IAAI,IAAI,CAAC,IAAI,YAAY,IAAI,EAAE;QAC7B,IAAI,CAAC,IAAI,EAAE,IAAI,CACb,gBAAgB,EAChB,IAAI,CAAC,SAAS,CAAC,EAAE,SAAS,EAAE,IAAI,CAAC,IAAI,EAAE,SAAS,EAAE,EAAE,SAAS,EAAE,CAAC,CACjE,CAAC;AACH,KAAA;SAAM,IAAI,IAAI,CAAC,IAAI,YAAY,IAAI,IAAI,IAAI,CAAC,WAAW,YAAY,IAAI,EAAE;QACxE,IAAI,CAAC,WAAW,EAAE,IAAI,CACpB,gBAAgB,EAChB,IAAI,CAAC,SAAS,CAAC,EAAE,SAAS,EAAE,IAAI,CAAC,WAAW,EAAE,SAAS,EAAE,EAAE,SAAS,EAAE,CAAC,CACxE,CAAC;AACH,KAAA;AACH;;;;"}